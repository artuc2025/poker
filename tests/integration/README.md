# Integration Tests

Этот раздел содержит integration-тесты для тестирования взаимодействия компонентов в приложении Poker Vue.

## Описание

Integration-тесты проверяют, как компоненты работают вместе, взаимодействуют с store и обрабатывают данные между собой. В отличие от unit-тестов, которые тестируют отдельные компоненты изолированно, integration-тесты проверяют реальные сценарии использования.

## Структура тестов

### 1. PlayerManager.integration.test.ts

Тестирует взаимодействие компонента `PlayerManager` с:

- **Store**: Обновление состояния игроков, количества карт
- **Другие компоненты**: Подготовка данных для `GameResults`
- **Реактивность**: Обновление UI при изменении состояния
- **Валидация**: Ограничения на количество игроков

**Основные сценарии:**

- Изменение количества игроков
- Отключение/включение игроков
- Блокировка управления во время раздачи карт
- Обновление количества карт в колоде

### 2. GameResults.integration.test.ts

Тестирует взаимодействие компонента `GameResults` с:

- **PokerCard**: Отображение карт игроков
- **Store**: Получение данных о результатах игры
- **Реактивность**: Обновление при изменении победителей
- **Стилизация**: CSS классы для победителей

**Основные сценарии:**

- Отображение карт через PokerCard компоненты
- Обработка множественных победителей
- Реактивное обновление результатов
- Валидация некорректных данных

### 3. PokerCard.integration.test.ts

Тестирует взаимодействие компонента `PokerCard` с:

- **Различные размеры**: small, medium, large, community
- **Состояния карт**: видимые, скрытые
- **Store**: Получение данных карт
- **Другие компоненты**: Использование в GameResults

**Основные сценарии:**

- Отображение карт разных размеров
- Переключение между видимыми и скрытыми картами
- Обработка всех мастей и рангов
- Интеграция с другими компонентами

### 4. FullGameFlow.integration.test.ts

Комплексный тест полного игрового процесса:

- **Полный цикл игры**: От настройки до результатов
- **Интеграция компонентов**: Взаимодействие всех компонентов
- **Обработка ошибок**: Граничные случаи
- **Производительность**: Большое количество данных

**Основные сценарии:**

- Полный игровой процесс от начала до конца
- Изменения состояния во время игры
- Отключение игроков
- Обработка минимального/максимального количества игроков
- Производительность с большим количеством данных

## Запуск тестов

### Запуск всех integration-тестов

```bash
npm run test:integration
```

### Запуск конкретного теста

```bash
npm run test tests/integration/PlayerManager.integration.test.ts
```

### Запуск с coverage

```bash
npm run test:integration:coverage
```

## Конфигурация

Integration-тесты используют:

- **Vitest**: Тестовый фреймворк
- **@vue/test-utils**: Утилиты для тестирования Vue компонентов
- **Pinia**: Управление состоянием
- **TypeScript**: Типизация

## Принципы тестирования

### 1. Изоляция тестов

Каждый тест начинается с чистого состояния store:

```typescript
beforeEach(() => {
  pinia = createPinia()
  setActivePinia(pinia)
  pokerStore = usePokerStore()
  pokerStore.startNewGame()
})
```

### 2. Реальные сценарии

Тесты симулируют реальное использование приложения:

- Взаимодействие пользователя с UI
- Изменения состояния в store
- Обновления компонентов

### 3. Проверка реактивности

Тесты проверяют, что UI обновляется при изменении данных:

```typescript
await wrapper.vm.$nextTick()
expect(wrapper.findAll('.player-item')).toHaveLength(5)
```

### 4. Валидация ошибок

Тесты проверяют обработку некорректных данных:

- Пустые массивы
- Некорректные типы данных
- Граничные случаи

## Покрытие тестирования

Integration-тесты покрывают:

### PlayerManager

- ✅ Взаимодействие с store
- ✅ Обновление количества игроков
- ✅ Отключение/включение игроков
- ✅ Блокировка управления
- ✅ Реактивность UI
- ✅ Валидация ограничений

### GameResults

- ✅ Интеграция с PokerCard
- ✅ Отображение результатов
- ✅ Множественные победители
- ✅ Реактивные обновления
- ✅ Обработка ошибок
- ✅ Стилизация

### PokerCard

- ✅ Различные размеры карт
- ✅ Состояния видимости
- ✅ Все масти и ранги
- ✅ Интеграция с store
- ✅ Анимации и стили
- ✅ Использование в других компонентах

### FullGameFlow

- ✅ Полный игровой процесс
- ✅ Интеграция всех компонентов
- ✅ Обработка ошибок
- ✅ Производительность
- ✅ Граничные случаи

## Добавление новых тестов

При добавлении новых integration-тестов следуйте принципам:

1. **Изоляция**: Каждый тест должен быть независимым
2. **Реальность**: Симулируйте реальные сценарии использования
3. **Покрытие**: Тестируйте как успешные, так и ошибочные сценарии
4. **Производительность**: Проверяйте работу с большими объемами данных

## Отладка тестов

### Логирование

Добавьте логи для отладки:

```typescript
console.log('Store state:', pokerStore.gameState)
console.log('Component HTML:', wrapper.html())
```

### Визуальная отладка

Для визуальной отладки можно временно добавить:

```typescript
await new Promise(resolve => setTimeout(resolve, 1000))
```

### Проверка состояния

Проверяйте промежуточные состояния:

```typescript
expect(pokerStore.gameState.players).toHaveLength(3)
expect(wrapper.find('.player-item').exists()).toBe(true)
```
